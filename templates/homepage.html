{% extends "base.html" %}
{% load static %}

{% block title %}Anasayfa{% endblock %}

{% block extra_styles %}
        <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
{% endblock %}

{% block navbar_extra %}
    <!-- Anasayfa için navbar içine input alanı -->
    <form class="d-flex" role="search">
        <input id="search-input" class="form-control me-2" type="search" placeholder="Müşteri kodu girin" aria-label="Search">
        <button class="btn btn-outline-success" type="submit">Ara</button>
    </form>
{% endblock %}

{% block content %}
    <div id="homepage-content">
        <!-- Kutular için grid sistemi -->
        <div class="row">
            <!-- Soldaki kutu (Müşteri Bilgileri) -->
            <div class="col-lg-6">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        Müşteri Bilgileri
                    </div>
                    <div class="card-body">
                        <p id="customer-loading">Gösterilecek veri yok...</p>
                        <div id="customer-info" style="display: none;">
                            <p><strong>Adı: </strong><span id="customer-name"></span></p>
                            <p><strong>Soyadı: </strong><span id="customer-surname"></span></p>
                            <p><strong>TC Kimlik No: </strong><span id="customer-identity"></span></p>
                            <p><strong>Baba Adı: </strong><span id="customer-father"></span></p>
                            <p><strong>Anne Adı: </strong><span id="customer-mother"></span></p>
                            <p><strong>Hesap Açılış Tarihi: </strong><span id="customer-opening"></span></p>
                            <p><strong>Toplam Gecikmiş Borç: </strong><span id="customer-overdue"></span></p>
                            <p><strong>Kötü Borç: </strong><span id="customer-bad-debt"></span></p>
                            <p><strong>Kredi Limiti: </strong><span id="customer-credit"></span></p>
                            <p><strong>Kalan Limit: </strong><span id="customer-remaining"></span></p>
                            <p><strong>Hesap Durumu: </strong><span id="customer-status"></span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sağdaki kutu (Telefon Bilgileri) -->
            <div class="col-lg-6">
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        <i class="fas fa-phone-alt"></i> Telefon Bilgileri
                        <button id="addPhoneBtn" class="btn btn-light btn-sm float-end" data-bs-toggle="modal" data-bs-target="#addPhoneModal" disabled>
                            <i class="fas fa-plus-circle"></i> Ekle
                        </button>
                    </div>
                    <div class="card-body">
                        <p id="phones-loading" class="text-center text-muted">Gösterilecek veri yok...</p>
                        <table id="phones-table" class="table table-hover table-striped" style="display: none;">
                            <thead class="table-dark">
                                <tr>
                                    <th>İletişim Türü</th>
                                    <th>Telefon Numarası</th>
                                </tr>
                            </thead>
                            <tbody id="phones-body">
                                <!-- Dinamik olarak doldurulacak -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="installments-tab" data-bs-toggle="tab" data-bs-target="#installments" type="button" role="tab" aria-controls="installments" aria-selected="true">Taksitler</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="notes-tab" data-bs-toggle="tab" data-bs-target="#notes" type="button" role="tab" aria-controls="notes" aria-selected="false">Notlar</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="messages-tab" data-bs-toggle="tab" data-bs-target="#messages" type="button" role="tab" aria-controls="messages" aria-selected="false">Mesajlar</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="attributes-tab" data-bs-toggle="tab" data-bs-target="#attributes" type="button" role="tab" aria-controls="attributes" aria-selected="false">Özellikler</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="addresses-tab" data-bs-toggle="tab" data-bs-target="#addresses" type="button" role="tab" aria-controls="addresses" aria-selected="false">Adresler</button>
        </li>
    </ul>
    
    <!-- Tab Content -->
    <div class="tab-content mt-3" id="myTabContent">
        <!-- Taksitler Tab -->
        <div class="tab-pane fade show active" id="installments" role="tabpanel" aria-labelledby="installments-tab">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Tarih</th>
                            <th>Ödeme Türü</th>
                            <th>Ödeme Miktarı</th>
                        </tr>
                    </thead>
                    <tbody id="installments-body">
                        <!-- Taksit verileri burada dinamik olarak doldurulacak -->
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Notlar Tab -->
        <div class="tab-pane fade" id="notes" role="tabpanel" aria-labelledby="notes-tab">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Tarih</th>
                            <th>Uyarı Türü</th>
                            <th>Açıklama</th>
                            <th>Notu Alan Kişi</th>
                        </tr>
                    </thead>
                    <tbody id="notes-list">
                        <!-- Dinamik olarak doldurulacak müşteri notları burada olacak -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Mesajlar Tab -->
        <div class="tab-pane fade" id="messages" role="tabpanel" aria-labelledby="messages-tab">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Telefon Numarası</th>
                            <th>Tarih</th>
                            <th>Mesaj</th>
                        </tr>
                    </thead>
                    <tbody id="messages-list">
                        <!-- Dinamik olarak doldurulacak müşteri mesajları burada olacak -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Özellikler Tab -->
        <div class="tab-pane fade" id="attributes" role="tabpanel" aria-labelledby="attributes-tab">
            <div class="d-flex justify-content-between mb-3">
                <h4>Özellikler</h4>
                <!-- Özellik Ekle Butonu -->
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAttributeModal">
                    <i class="fas fa-plus-circle"></i> Özellik Ekle
                </button>
            </div>

            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Özellik Türü</th>
                            <th>Açıklama</th>
                        </tr>
                    </thead>
                    <tbody id="attributes-list">
                        <!-- Dinamik olarak doldurulacak müşteri özellikleri burada olacak -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Adresler Tab -->
        <div class="tab-pane fade" id="addresses" role="tabpanel" aria-labelledby="addresses-tab">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Adres Türü</th>
                            <th>Adres</th>
                        </tr>
                    </thead>
                    <tbody id="addresses-list">
                        <!-- Dinamik olarak doldurulacak müşteri adresleri burada olacak -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>


   <!-- Telefon Ekleme Modülü (Bootstrap Modal) -->
    <div class="modal fade" id="addPhoneModal" tabindex="-1" aria-labelledby="addPhoneModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addPhoneModalLabel">Yeni Telefon Bilgisi Ekle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
                </div>
                <div class="modal-body">
                    <form id="addPhoneForm">
                        <div class="mb-3">
                            <!-- İletişim Türü Dropdown -->
                            <label for="communicationType" class="form-label">İletişim Türü</label>
                            <select class="form-select" id="communicationType" required>
                                <option value="" disabled selected>İletişim türü seçin</option>
                                <option value="001">Kendi Cep Telefonu</option>
                                <option value="002">Ulaşılmasını İstediği 2. Cep Numarası</option>
                                <option value="003">İş Telefonu</option>
                                <option value="004">Ev Telefonu</option>
                                <option value="005">E-Mail</option>
                                <option value="006">Ek Kullanıcı 1 Cep Tel</option>
                                <option value="007">Ek Kullanıcı 2 Cep Tel</option>
                                <option value="008">Ek Kullanıcı 3 Cep Tel</option>
                                <option value="009">KASİYER DENEME GİRECEĞİ TEL</option>
                                <option value="010">Baba Telefonu</option>
                                <option value="011">Anne Telefonu</option>
                                <option value="012">Eşinin Telefonu</option>
                                <option value="013">Arkadaş Telefonu</option>
                                <option value="014">Kardeş (Aile Bireyi)</option>
                                <option value="015">İsimli Tel. Alma</option>
                                <option value="016">Kızı</option>
                                <option value="017">Oğlu</option>
                                <option value="018">Yakın Akrabası</option>
                                <option value="019">Tanıdığı</option>
                                <option value="020">Kullanım Dışı</option>
                                <option value="021">Başkası Tarafından Kullanılıyor</option>
                                <option value="022">Güncel Olabilecek Telefonu</option>
                                <option value="023">Yeni Güncel Güncel Telefonu Olabilir</option>
                                <option value="024">Avukata Gelen Kendi Telefon Numarası</option>
                                <option value="025">Avukata Gelen Akraba ve Yakını Telefonu</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <!-- Telefon Numarası -->
                            <label for="phoneNumber" class="form-label">Telefon Numarası</label>
                            <input type="text" class="form-control" id="phoneNumber" placeholder="Telefon numarası girin" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Kaydet</button>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- Özellik Ekleme Modülü (Bootstrap Modal) -->
    <div class="modal fade" id="addAttributeModal" tabindex="-1" aria-labelledby="addAttributeModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addAttributeModalLabel">Yeni Özellik Ekle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addAttributeForm">
                        <div class="mb-3">
                            <label for="attributeType" class="form-label">Özellik Türü</label>
                            <select class="form-select" id="attributeType" required>
                                <option selected disabled>Özellik türü seçin...</option>
                                <!-- Dinamik olarak doldurulacak -->
                            </select>
                        </div>

                        <!-- Dinamik olarak gelen veriler (Attribute listesi) -->
                        <div id="dynamicAttributeSection" class="mb-3" style="display:none;">
                            <label for="dynamicAttributeSelect" class="form-label">Özellik Seçin</label>
                            <select class="form-select" id="dynamicAttributeSelect" required>
                                <option selected disabled>Özellik seçin...</option>
                                <!-- API'den gelen seçenekler buraya eklenecek -->
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary">Kaydet</button>
                    </form>
                </div>
            </div>
        </div>
    </div>


{% endblock %}

{% block extra_scripts %}
    <script src="{% static 'js/homepage.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="{% static 'js/homepage.js' %}"></script>
{% endblock %}
